<!DOCTYPE html>
<html>
<head>
    <title>Direct D-ID Test</title>
</head>
<body>
    <h1>Direct D-ID API Test</h1>
    <div id="status">Testing...</div>
    <div id="results"></div>

    <script>
        async function testDirectDID() {
            const status = document.getElementById('status');
            const results = document.getElementById('results');
            
            try {
                status.textContent = 'Testing backend proxy...';
                
                // Test 1: Our proxy health
                try {
                    const proxyHealthResponse = await fetch('https://d-id-agent-1sdx.onrender.com/');
                    const proxyHealthData = await proxyHealthResponse.text();
                    results.innerHTML += '<h3>✅ Proxy Health:</h3><pre>' + proxyHealthData + '</pre>';
                } catch (e) {
                    results.innerHTML += '<h3>❌ Proxy Health Error:</h3><pre>' + e.message + '</pre>';
                }
                
                // Test 2: Our proxy client key
                try {
                    const clientKeyResponse = await fetch('https://d-id-agent-1sdx.onrender.com/api/client-key', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            agentId: 'v2_agt_aKkqeO6X',
                            allowed_domains: [window.location.origin]
                        })
                    });
                    
                    if (clientKeyResponse.ok) {
                        const clientKeyData = await clientKeyResponse.json();
                        results.innerHTML += '<h3>✅ Proxy Client Key:</h3><pre>' + JSON.stringify(clientKeyData, null, 2) + '</pre>';
                    } else {
                        const errorText = await clientKeyResponse.text();
                        results.innerHTML += '<h3>❌ Proxy Client Key Error:</h3><pre>Status: ' + clientKeyResponse.status + '\nResponse: ' + errorText + '</pre>';
                    }
                } catch (e) {
                    results.innerHTML += '<h3>❌ Proxy Client Key Error:</h3><pre>' + e.message + '</pre>';
                }
                
                // Test 3: Test agent endpoint
                try {
                    const agentResponse = await fetch('https://d-id-agent-1sdx.onrender.com/api/agents/v2_agt_aKkqeO6X');
                    if (agentResponse.ok) {
                        const agentData = await agentResponse.text();
                        results.innerHTML += '<h3>✅ Agent Endpoint:</h3><pre>' + agentData + '</pre>';
                    } else {
                        const errorText = await agentResponse.text();
                        results.innerHTML += '<h3>⚠️ Agent Endpoint (Expected Error):</h3><pre>Status: ' + agentResponse.status + '\nResponse: ' + errorText + '</pre>';
                    }
                } catch (e) {
                    results.innerHTML += '<h3>❌ Agent Endpoint Error:</h3><pre>' + e.message + '</pre>';
                }
                
                // Test 4: Test streams endpoint
                try {
                    const streamsResponse = await fetch('https://d-id-agent-1sdx.onrender.com/api/agents/v2_agt_aKkqeO6X/streams', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({})
                    });
                    
                    if (streamsResponse.ok) {
                        const streamsData = await streamsResponse.json();
                        results.innerHTML += '<h3>✅ Streams Endpoint:</h3><pre>' + JSON.stringify(streamsData, null, 2) + '</pre>';
                    } else {
                        const errorText = await streamsResponse.text();
                        results.innerHTML += '<h3>⚠️ Streams Endpoint (Expected Error):</h3><pre>Status: ' + streamsResponse.status + '\nResponse: ' + errorText + '</pre>';
                    }
                } catch (e) {
                    results.innerHTML += '<h3>❌ Streams Endpoint Error:</h3><pre>' + e.message + '</pre>';
                }
                
                status.textContent = 'Backend tests completed!';
                
            } catch (error) {
                status.textContent = 'Error: ' + error.message;
                results.innerHTML += '<h3>❌ General Error:</h3><pre>' + error.message + '</pre>';
            }
        }
        
        // Run test when page loads
        testDirectDID();
    </script>
</body>
</html>
